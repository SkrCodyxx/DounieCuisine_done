import { storage } from "./storage";
import bcrypt from "bcrypt";

export async function initializeData() {
  console.log("üöÄ Initialisation des donn√©es Dounie Cuisine...");

  try {
    // Initialiser les permissions par r√¥le
    await initializeRolePermissions();
    
    // Initialiser les param√®tres de l'entreprise
    await initializeCompanySettings();
    
    // Initialiser les utilisateurs par d√©faut
    await initializeDefaultUsers();
    
    // Initialiser les galeries par d√©faut
    await initializeDefaultGalleries();
    
    // Initialiser les pages de contenu
    await initializeContentPages();
    
    // Initialiser les donn√©es du menu (existant)
    await initializeMenuData();
    
    // Initialiser les th√®mes festifs (existant)
    await initializeFestiveThemes();
    
    // Initialiser les annonces par d√©faut
    await initializeDefaultAnnouncements();

    console.log("‚úÖ Initialisation termin√©e avec succ√®s!");
  } catch (error) {
    console.error("‚ùå Erreur lors de l'initialisation:", error);
    throw error;
  }
}

async function initializeRolePermissions() {
  console.log("üîê Initialisation des permissions par r√¥le...");
  
  const roles = [
    {
      roleName: 'admin',
      description: 'Administrateur syst√®me - Acc√®s complet',
      permissions: {
        // Gestion utilisateurs
        manage_users: true,
        view_users: true,
        create_users: true,
        edit_users: true,
        delete_users: true,
        
        // Gestion clients
        manage_clients: true,
        view_clients: true,
        create_clients: true,
        edit_clients: true,
        delete_clients: true,
        
        // Gestion menu
        manage_menu: true,
        view_menu: true,
        create_menu_items: true,
        edit_menu_items: true,
        delete_menu_items: true,
        
        // Gestion devis
        manage_quotes: true,
        view_quotes: true,
        create_quotes: true,
        edit_quotes: true,
        delete_quotes: true,
        send_quotes: true,
        
        // Gestion commandes
        manage_orders: true,
        view_orders: true,
        edit_orders: true,
        cancel_orders: true,
        
        // Gestion r√©servations
        manage_reservations: true,
        view_reservations: true,
        edit_reservations: true,
        cancel_reservations: true,
        
        // Gestion galeries
        manage_galleries: true,
        view_galleries: true,
        create_galleries: true,
        edit_galleries: true,
        delete_galleries: true,
        upload_images: true,
        
        // Gestion contenu
        manage_content: true,
        view_content: true,
        create_content: true,
        edit_content: true,
        delete_content: true,
        
        // Gestion annonces
        manage_announcements: true,
        view_announcements: true,
        create_announcements: true,
        edit_announcements: true,
        delete_announcements: true,
        
        // Messagerie
        manage_internal_messaging: true,
        view_customer_messages: true,
        respond_customer_messages: true,
        send_client_messages: true,
        
        // Finances
        manage_finances: true,
        view_financial_reports: true,
        create_transactions: true,
        
        // Param√®tres syst√®me
        manage_company_settings: true,
        manage_permissions: true,
        view_system_logs: true,
        
        // Inventaire
        manage_inventory: true,
        view_inventory: true,
        
        // Calendrier
        manage_calendar: true,
        view_calendar: true,
        
        // Personnel
        manage_staff: true,
        view_staff: true,
      }
    },
    {
      roleName: 'manager',
      description: 'Manager - Gestion op√©rationnelle',
      permissions: {
        // Gestion clients
        manage_clients: true,
        view_clients: true,
        create_clients: true,
        edit_clients: true,
        delete_clients: false,
        
        // Gestion menu
        manage_menu: true,
        view_menu: true,
        create_menu_items: true,
        edit_menu_items: true,
        delete_menu_items: false,
        
        // Gestion devis
        manage_quotes: true,
        view_quotes: true,
        create_quotes: true,
        edit_quotes: true,
        delete_quotes: false,
        send_quotes: true,
        
        // Gestion commandes
        manage_orders: true,
        view_orders: true,
        edit_orders: true,
        cancel_orders: true,
        
        // Gestion r√©servations
        manage_reservations: true,
        view_reservations: true,
        edit_reservations: true,
        cancel_reservations: true,
        
        // Gestion galeries
        manage_galleries: true,
        view_galleries: true,
        create_galleries: false,
        edit_galleries: true,
        delete_galleries: false,
        upload_images: true,
        
        // Gestion contenu
        manage_content: false,
        view_content: true,
        edit_content: false,
        
        // Gestion annonces
        manage_announcements: true,
        view_announcements: true,
        create_announcements: true,
        edit_announcements: true,
        delete_announcements: false,
        
        // Messagerie
        manage_internal_messaging: true,
        view_customer_messages: true,
        respond_customer_messages: true,
        send_client_messages: true,
        
        // Finances
        view_financial_reports: true,
        create_transactions: true,
        
        // Inventaire
        manage_inventory: true,
        view_inventory: true,
        
        // Calendrier
        manage_calendar: true,
        view_calendar: true,
        
        // Personnel
        view_staff: true,
      }
    },
    {
      roleName: 'staff',
      description: 'Personnel - Op√©rations de base',
      permissions: {
        // Gestion clients
        view_clients: true,
        create_clients: true,
        edit_clients: true,
        
        // Menu
        view_menu: true,
        edit_menu_items: false,
        
        // Gestion devis
        view_quotes: true,
        create_quotes: true,
        edit_quotes: true,
        send_quotes: false,
        
        // Gestion commandes
        view_orders: true,
        edit_orders: true,
        
        // Gestion r√©servations
        view_reservations: true,
        edit_reservations: true,
        
        // Galeries
        view_galleries: true,
        upload_images: false,
        
        // Messagerie
        manage_internal_messaging: true,
        view_customer_messages: true,
        respond_customer_messages: true,
        
        // Inventaire
        view_inventory: true,
        
        // Calendrier
        view_calendar: true,
      }
    },
    {
      roleName: 'client',
      description: 'Client - Acc√®s limit√©',
      permissions: {
        // Commandes personnelles
        view_own_orders: true,
        create_orders: true,
        
        // R√©servations personnelles
        view_own_reservations: true,
        create_reservations: true,
        
        // Menu public
        view_menu: true,
        
        // Galeries publiques
        view_galleries: true,
        
        // Messages
        send_customer_messages: true,
      }
    }
  ];

  for (const role of roles) {
    const existingRole = await storage.getRolePermissionByName(role.roleName);
    if (!existingRole) {
      await storage.createRolePermission(role);
      console.log(`‚úÖ R√¥le cr√©√©: ${role.roleName}`);
    }
  }
}

async function initializeCompanySettings() {
  console.log("üè¢ Initialisation des param√®tres de l'entreprise...");
  
  const existingSettings = await storage.getCompanySettings();
  if (!existingSettings) {
    await storage.createCompanySettings({
      companyName: "Dounie Cuisine",
      address: "Montr√©al, QC, Canada",
      phoneNumber: "+1 (514) 123-4567",
      email: "contact@dounie-cuisine.ca",
      website: "https://dounie-cuisine.ca",
      logoUrl: "/images/logo-dounie.png",
      siret: "12345678901234",
      tvaNumber: "FR12345678901",
      salesPolicy: `## Politique de Vente - Dounie Cuisine

### Conditions G√©n√©rales
- Toutes nos prestations sont soumises aux pr√©sentes conditions g√©n√©rales de vente
- Les prix sont indiqu√©s en CAD, taxes comprises (TPS/TVQ)
- Un acompte de 30% est demand√© √† la confirmation de commande

### Modalit√©s de Paiement
- Esp√®ces, carte bancaire, virement bancaire accept√©s
- Paiement de l'acompte √† la commande
- Solde √† r√©gler le jour de la prestation

### D√©lais
- Commande minimale de 48h pour les prestations traiteur
- Commande minimale de 7 jours pour les √©v√©nements importants (+ de 50 personnes)`,
      
      returnPolicy: `## Politique de Retour - Dounie Cuisine

### Produits Alimentaires
- Aucun retour possible sur les produits alimentaires frais pour des raisons sanitaires
- En cas de probl√®me qualit√©, nous nous engageons √† remplacer ou rembourser

### Annulation
- Annulation gratuite jusqu'√† 24h avant la prestation
- Annulation entre 24h et 12h : 50% de l'acompte retenu
- Annulation moins de 12h avant : acompte non remboursable

### R√©clamations
- Toute r√©clamation doit √™tre formul√©e dans les 24h suivant la prestation
- Nous nous engageons √† traiter toute r√©clamation dans les 48h`,
      
      cancellationPolicy: `## Politique d'Annulation - Dounie Cuisine

### D√©lais d'Annulation
1. **Plus de 7 jours avant** : Annulation gratuite, remboursement int√©gral
2. **Entre 7 et 3 jours avant** : Frais d'annulation de 25%
3. **Entre 3 jours et 24h avant** : Frais d'annulation de 50%
4. **Moins de 24h avant** : Frais d'annulation de 100%

### Cas Exceptionnels
- Force majeure (m√©t√©o, urgence sanitaire) : remboursement int√©gral
- Maladie justifi√©e par certificat m√©dical : remboursement √† 75%

### Proc√©dure
- Annulation par t√©l√©phone ou email
- Confirmation √©crite de l'annulation envoy√©e par nos soins
- Remboursement sous 5 √† 10 jours ouvr√©s`,
      
      termsOfService: `## Conditions G√©n√©rales d'Utilisation - Dounie Cuisine

### Acceptation des Conditions
En utilisant nos services, vous acceptez les pr√©sentes conditions g√©n√©rales.

### Propri√©t√© Intellectuelle
Tous les contenus pr√©sents sur notre site sont prot√©g√©s par le droit d'auteur.

### Protection des Donn√©es
Nous nous engageons √† prot√©ger vos donn√©es personnelles conform√©ment au RGPD.

### Responsabilit√©
Notre responsabilit√© est limit√©e au montant de la prestation command√©e.`,
      
      privacyPolicy: `## Politique de Confidentialit√© - Dounie Cuisine

### Collecte des Donn√©es
Nous collectons uniquement les donn√©es n√©cessaires √† la fourniture de nos services.

### Utilisation des Donn√©es
- Traitement des commandes et r√©servations
- Communication commerciale (avec votre accord)
- Am√©lioration de nos services

### Vos Droits
Vous disposez d'un droit d'acc√®s, de rectification et de suppression de vos donn√©es.

### Conservation
Vos donn√©es sont conserv√©es 3 ans apr√®s votre derni√®re commande.

### Contact
Pour toute question : privacy@dounie-cuisine.ca`,
      
      bankInfo: {
        bankName: "Banque Nationale du Canada",
        accountName: "Dounie Cuisine Inc.",
        accountNumber: "****1234",
        swiftCode: "BNDCCAMMTOR",
        iban: "CA123456789012345678901234"
      },
      defaultQuoteValidity: 30
    });
    console.log("‚úÖ Param√®tres d'entreprise initialis√©s");
  }
}

async function initializeDefaultUsers() {
  console.log("üë• Initialisation des utilisateurs par d√©faut...");
  
  const defaultUsers = [
    {
      username: "admin",
      email: "admin@dounie-cuisine.ca",
      password: "Admin123!",
      firstName: "Administrateur",
      lastName: "Syst√®me",
      role: "admin"
    },
    {
      username: "manager",
      email: "manager@dounie-cuisine.ca", 
      password: "Manager123!",
      firstName: "Lucie",
      lastName: "Manager",
      role: "manager"
    },
    {
      username: "staff",
      email: "staff@dounie-cuisine.ca",
      password: "Staff123!",
      firstName: "Marc",
      lastName: "Staff",
      role: "staff"
    }
  ];

  for (const userData of defaultUsers) {
    const existingUser = await storage.getUserByEmail(userData.email);
    if (!existingUser) {
      const hashedPassword = await bcrypt.hash(userData.password, 10);
      
      const user = await storage.createUser({
        ...userData,
        password: hashedPassword,
        phoneNumber: null,
        loyaltyPoints: 0,
        preferences: {
          language: 'fr',
          notifications: true,
          theme: 'haitian'
        },
        allergies: []
      });

      // Cr√©er un employ√© pour les non-clients
      if (userData.role !== 'client') {
        await storage.createEmployee({
          userId: user.id,
          employeeId: `EMP${String(user.id).padStart(4, '0')}`,
          position: userData.role === 'admin' ? 'Administrateur' : 
                   userData.role === 'manager' ? 'Manager' : 'Staff',
          department: 'Administration',
          hireDate: new Date().toISOString().split('T')[0],
          hourlyRate: userData.role === 'admin' ? '35.00' : 
                     userData.role === 'manager' ? '25.00' : '18.00',
          isActive: true,
          certifications: [],
          availability: {},
          permissions: {}
        });
      }
      
      console.log(`‚úÖ Utilisateur cr√©√©: ${userData.username}`);
    }
  }
}

async function initializeDefaultGalleries() {
  console.log("üñºÔ∏è Initialisation des galeries par d√©faut...");
  
  const galleries = [
    {
      name: "Plats Signature",
      description: "Nos cr√©ations culinaires embl√©matiques",
      isActive: true,
      sortOrder: 1
    },
    {
      name: "√âv√©nements",
      description: "Photos de nos prestations √©v√©nementielles",
      isActive: true,
      sortOrder: 2
    },
    {
      name: "Cuisine en Action",
      description: "Nos chefs √† l'≈ìuvre",
      isActive: true,
      sortOrder: 3
    },
    {
      name: "Ambiance Restaurant",
      description: "L'atmosph√®re de notre √©tablissement",
      isActive: true,
      sortOrder: 4
    }
  ];

  for (const gallery of galleries) {
    const existingGallery = await storage.getGalleries();
    const found = existingGallery.find(g => g.name === gallery.name);
    if (!found) {
      await storage.createGallery(gallery);
      console.log(`‚úÖ Galerie cr√©√©e: ${gallery.name}`);
    }
  }
}

async function initializeContentPages() {
  console.log("üìÑ Initialisation des pages de contenu...");
  
  const pages = [
    {
      slug: "faq",
      title: "Questions Fr√©quemment Pos√©es",
      content: `# Questions Fr√©quemment Pos√©es

## Commandes et Livraisons

### Quel est le d√©lai minimum pour commander ?
Nous demandons un d√©lai minimum de 48h pour les commandes standard et 7 jours pour les √©v√©nements importants (plus de 50 personnes).

### Livrez-vous ?
Oui, nous livrons dans un rayon de 25km autour de Montr√©al. Des frais de livraison peuvent s'appliquer selon la distance.

### Peut-on personnaliser les menus ?
Absolument ! Nous adaptons nos menus selon vos go√ªts, allergies et restrictions alimentaires.

## Paiement

### Quels moyens de paiement acceptez-vous ?
Nous acceptons les esp√®ces, cartes bancaires, virements bancaires et Interac.

### Quand dois-je payer ?
Un acompte de 30% est demand√© √† la confirmation, le solde √©tant d√ª le jour de la prestation.

## Allergies et R√©gimes

### Proposez-vous des options v√©g√©tariennes/v√©ganes ?
Oui, nous avons une large gamme de plats v√©g√©tariens et v√©g√©taliens. Consultez notre section d√©di√©e.

### Comment g√©rez-vous les allergies alimentaires ?
Nous prenons les allergies tr√®s au s√©rieux. Informez-nous lors de votre commande et nous adapterons la pr√©paration.

## Annulations

### Puis-je annuler ma commande ?
Oui, selon notre politique d'annulation d√©taill√©e dans nos conditions g√©n√©rales.

### Que se passe-t-il en cas de force majeure ?
En cas de force majeure (m√©t√©o, urgence sanitaire), nous remboursons int√©gralement.`,
      metaDescription: "Trouvez les r√©ponses √† vos questions sur nos services traiteur, livraisons, paiements et plus encore.",
      isActive: true,
      showInNavigation: true,
      sortOrder: 1
    },
    {
      slug: "about",
      title: "√Ä Propos de Dounie Cuisine",
      content: `# √Ä Propos de Dounie Cuisine

## Notre Histoire

Dounie Cuisine est n√©e de la passion de cr√©er des exp√©riences culinaires m√©morables qui c√©l√®brent les saveurs authentiques des Cara√Øbes, avec une touche moderne et raffin√©e.

## Notre Mission

Nous nous engageons √† :
- Offrir une cuisine authentique et de qualit√© sup√©rieure
- Utiliser des ingr√©dients frais et locaux quand possible
- Cr√©er des moments de partage et de convivialit√©
- Respecter les traditions culinaires carib√©ennes

## Notre √âquipe

Notre √©quipe de chefs passionn√©s combine expertise traditionnelle et innovation culinaire pour vous offrir des plats exceptionnels.

## Nos Valeurs

- **Qualit√©** : Nous ne transigeons jamais sur la qualit√© de nos ingr√©dients et pr√©parations
- **Authenticit√©** : Respect des recettes traditionnelles
- **Innovation** : Adaptation aux go√ªts contemporains
- **Service** : Excellence dans l'accueil et le service client

## Certifications

- Certification MAPAQ
- Certification sanitaire AAA
- Formation continue de l'√©quipe aux normes d'hygi√®ne`,
      metaDescription: "D√©couvrez l'histoire, la mission et les valeurs de Dounie Cuisine, votre sp√©cialiste de la cuisine carib√©enne.",
      isActive: true,
      showInNavigation: true,
      sortOrder: 2
    },
    {
      slug: "contact",
      title: "Nous Contacter",
      content: `# Nous Contacter

## Coordonn√©es

**Adresse :** Montr√©al, QC, Canada
**T√©l√©phone :** +1 (514) 123-4567
**Email :** contact@dounie-cuisine.ca

## Horaires d'Ouverture

**Lundi - Vendredi :** 9h00 - 19h00
**Samedi :** 10h00 - 18h00
**Dimanche :** 11h00 - 17h00

## Zone de Livraison

Nous livrons dans un rayon de 25km autour de Montr√©al :
- Montr√©al et arrondissements
- Laval
- Longueuil
- Brossard
- Saint-Lambert

## Nous Suivre

Restez connect√©s pour nos derni√®res cr√©ations et offres sp√©ciales !

**Facebook :** @douinecuisine
**Instagram :** @dounie_cuisine
**Twitter :** @douinecuisine`,
      metaDescription: "Contactez Dounie Cuisine pour vos commandes et renseignements. Coordonn√©es, horaires et zone de livraison.",
      isActive: true,
      showInNavigation: true,
      sortOrder: 3
    }
  ];

  const adminUser = await storage.getUserByEmail("admin@dounie-cuisine.ca");
  const adminId = adminUser?.id || 1;

  for (const page of pages) {
    const existingPage = await storage.getContentPageBySlug(page.slug);
    if (!existingPage) {
      await storage.createContentPage({
        ...page,
        lastEditedBy: adminId
      });
      console.log(`‚úÖ Page cr√©√©e: ${page.title}`);
    }
  }
}

async function initializeMenuData() {
  console.log("üçΩÔ∏è Initialisation des donn√©es du menu...");
  
  const menuCategories = {
    "plats-principaux": [
      {
        name: "Griot Traditionnel",
        nameEn: "Traditional Griot",
        description: "Porc marin√© et frit, accompagn√© de riz coll√© aux pois rouges et de bananes plantains frites",
        descriptionEn: "Marinated and fried pork, served with rice and red beans and fried plantains",
        price: "18.50",
        imageUrl: "/images/menu/griot-traditionnel.jpg",
        preparationTime: 25,
        calories: 680,
        allergies: [],
        ingredients: ["porc", "riz", "pois rouges", "bananes plantains", "√©pices cr√©oles"]
      },
      {
        name: "Poisson Gros Sel",
        nameEn: "Salt Fish",
        description: "Morue dessal√©e saut√©e aux l√©gumes cr√©oles, riz blanc et sauce ti-malice",
        descriptionEn: "Desalted cod saut√©ed with Creole vegetables, white rice and ti-malice sauce",
        price: "16.75",
        imageUrl: "/images/menu/poisson-gros-sel.jpg",
        preparationTime: 20,
        calories: 520,
        allergies: ["poisson"],
        ingredients: ["morue", "l√©gumes cr√©oles", "riz", "sauce ti-malice"]
      },
      {
        name: "Poulet Boucann√©",
        nameEn: "Smoked Chicken",
        description: "Poulet marin√© aux √©pices et grill√© au feu de bois, accompagn√© de l√©gumes racines",
        descriptionEn: "Chicken marinated with spices and grilled over wood fire, served with root vegetables",
        price: "17.25",
        imageUrl: "/images/menu/poulet-boucanne.jpg",
        preparationTime: 30,
        calories: 590,
        allergies: [],
        ingredients: ["poulet", "√©pices cr√©oles", "l√©gumes racines", "marinade"]
      }
    ],
    "entrees": [
      {
        name: "Accras de Morue",
        nameEn: "Cod Fritters",
        description: "Beignets de morue √©pic√©s, croustillants √† l'ext√©rieur et moelleux √† l'int√©rieur",
        descriptionEn: "Spiced cod fritters, crispy outside and tender inside",
        price: "8.50",
        imageUrl: "/images/menu/accras-morue.jpg",
        preparationTime: 15,
        calories: 280,
        allergies: ["poisson", "gluten"],
        ingredients: ["morue", "farine", "√©pices", "huile"]
      },
      {
        name: "Boudin Cr√©ole",
        nameEn: "Creole Blood Sausage",
        description: "Boudin noir aux √©pices antillaises, accompagn√© de sauce piment",
        descriptionEn: "Black pudding with West Indian spices, served with hot sauce",
        price: "9.25",
        imageUrl: "/images/menu/boudin-creole.jpg",
        preparationTime: 12,
        calories: 320,
        allergies: [],
        ingredients: ["sang de porc", "√©pices cr√©oles", "oignons", "piment"]
      }
    ],
    "desserts": [
      {
        name: "Blanc-Manger Coco",
        nameEn: "Coconut Blancmange",
        description: "Dessert cr√©meux √† la noix de coco, parfum√© √† la vanille et cannelle",
        descriptionEn: "Creamy coconut dessert, flavored with vanilla and cinnamon",
        price: "6.50",
        imageUrl: "/images/menu/blanc-manger-coco.jpg",
        preparationTime: 10,
        calories: 220,
        allergies: ["lait"],
        ingredients: ["lait de coco", "vanille", "cannelle", "sucre"]
      },
      {
        name: "Tarte √† la Patate Douce",
        nameEn: "Sweet Potato Pie",
        description: "Tarte cr√©meuse √† la patate douce √©pic√©e, p√¢te sabl√©e maison",
        descriptionEn: "Creamy spiced sweet potato pie with homemade shortbread crust",
        price: "7.75",
        imageUrl: "/images/menu/tarte-patate-douce.jpg",
        preparationTime: 15,
        calories: 310,
        allergies: ["gluten", "≈ìufs", "lait"],
        ingredients: ["patate douce", "√©pices", "p√¢te sabl√©e", "≈ìufs", "cr√®me"]
      }
    ],
    "boissons": [
      {
        name: "Jus de Fruit de la Passion",
        nameEn: "Passion Fruit Juice",
        description: "Jus naturel de fruit de la passion, rafra√Æchissant et vitamin√©",
        descriptionEn: "Natural passion fruit juice, refreshing and vitamin-rich",
        price: "4.50",
        imageUrl: "/images/menu/jus-passion.jpg",
        preparationTime: 5,
        calories: 95,
        allergies: [],
        ingredients: ["fruit de la passion", "eau", "sucre de canne"]
      },
      {
        name: "Punch Planteur",
        nameEn: "Planter's Punch",
        description: "Cocktail traditionnel au rhum, jus de fruits tropicaux (sans alcool disponible)",
        descriptionEn: "Traditional rum cocktail with tropical fruit juices (non-alcoholic available)",
        price: "8.25",
        imageUrl: "/images/menu/punch-planteur.jpg",
        preparationTime: 5,
        calories: 180,
        allergies: [],
        ingredients: ["rhum", "jus d'ananas", "jus d'orange", "grenadine", "muscade"]
      }
    ]
  };

  for (const [category, items] of Object.entries(menuCategories)) {
    for (const item of items) {
      const existingItems = await storage.getMenuItems();
      const found = existingItems.find(existing => existing.name === item.name);
      
      if (!found) {
        await storage.createMenuItem({
          ...item,
          category,
          isAvailable: true,
          isFestive: false,
          festiveTheme: null
        });
        console.log(`‚úÖ Plat ajout√©: ${item.name}`);
      }
    }
  }
}

async function initializeFestiveThemes() {
  console.log("üé≠ Initialisation des th√®mes festifs...");
  
  const themes = [
    {
      name: "Ha√Øtien Classique",
      nameEn: "Classic Haitian",
      description: "Th√®me traditionnel aux couleurs du drapeau ha√Øtien",
      isActive: true,
      isAutomatic: false,
      colors: {
        primary: "#0072CE",
        secondary: "#CE1126", 
        accent: "#FFD100",
        background: "#F8F9FA"
      },
      animations: {},
      icons: {
        flag: "üá≠üáπ",
        food: "üçΩÔ∏è",
        celebration: "üéâ"
      },
      priority: 1,
      recurringYearly: false
    },
    {
      name: "Carnaval",
      nameEn: "Carnival",
      description: "Th√®me festif pour la p√©riode du carnaval",
      isActive: false,
      isAutomatic: true,
      startDate: "2025-02-01",
      endDate: "2025-03-15",
      colors: {
        primary: "#FF6B35",
        secondary: "#F7931E",
        accent: "#FFD23F",
        background: "#FFF8E1"
      },
      animations: {
        confetti: true,
        bounce: true
      },
      icons: {
        mask: "üé≠",
        music: "üéµ",
        dance: "üíÉ"
      },
      priority: 2,
      recurringYearly: true
    },
    {
      name: "F√™te des M√®res",
      nameEn: "Mother's Day",
      description: "Th√®me sp√©cial pour la f√™te des m√®res",
      isActive: false,
      isAutomatic: true,
      startDate: "2025-05-01",
      endDate: "2025-05-31",
      colors: {
        primary: "#E91E63",
        secondary: "#F8BBD9",
        accent: "#FF4081",
        background: "#FCE4EC"
      },
      animations: {
        hearts: true,
        sparkle: true
      },
      icons: {
        heart: "üíù",
        flower: "üå∏",
        love: "üíñ"
      },
      priority: 3,
      recurringYearly: true
    }
  ];

  for (const theme of themes) {
    const existingThemes = await storage.getFestiveThemes();
    const found = existingThemes.find(t => t.name === theme.name);
    
    if (!found) {
      await storage.createFestiveTheme(theme);
      console.log(`‚úÖ Th√®me cr√©√©: ${theme.name}`);
    }
  }
}

async function initializeDefaultAnnouncements() {
  console.log("üì¢ Initialisation des annonces par d√©faut...");
  
  const adminUser = await storage.getUserByEmail("admin@dounie-cuisine.ca");
  const adminId = adminUser?.id || 1;
  
  const announcements = [
    {
      title: "Bienvenue chez Dounie Cuisine!",
      content: "D√©couvrez nos sp√©cialit√©s carib√©ennes authentiques et nos services traiteur pour tous vos √©v√©nements.",
      type: "info",
      priority: "normal",
      position: "banner",
      targetAudience: "all",
      isActive: true,
      startDate: new Date(),
      endDate: null,
      imageUrl: null,
      actionUrl: "/menu",
      actionText: "Voir notre menu",
      viewCount: 0,
      displayRules: {
        showOnHomepage: true,
        showToNewVisitors: true
      },
      createdBy: adminId
    },
    {
      title: "Nouveau: Service de Devis en Ligne",
      content: "Demandez facilement un devis personnalis√© pour vos √©v√©nements directement depuis notre interface.",
      type: "success",
      priority: "high",
      position: "modal",
      targetAudience: "customers",
      isActive: true,
      startDate: new Date(),
      endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 jours
      imageUrl: null,
      actionUrl: "/contact",
      actionText: "Demander un devis",
      viewCount: 0,
      displayRules: {
        showOnce: true,
        requiresLogin: false
      },
      createdBy: adminId
    }
  ];

  for (const announcement of announcements) {
    const existingAnnouncements = await storage.getAnnouncements();
    const found = existingAnnouncements.find(a => a.title === announcement.title);
    
    if (!found) {
      await storage.createAnnouncement(announcement);
      console.log(`‚úÖ Annonce cr√©√©e: ${announcement.title}`);
    }
  }
}